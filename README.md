# 门店报表查询系统

## 系统概述

这是一个基于 Streamlit 开发的门店报表查询系统，支持多门店独立登录查询各自的财务报表。系统具有权限管理、报表查询、数据筛选和下载等功能。

## 主要功能

### 1. 权限管理
- 支持通过Excel表格管理门店权限
- 每个门店的员工通过门店名称和人员编号登录
- 登录后只能查看本门店的报表

### 2. 报表查询
- 支持上传包含多个Sheet的Excel报表文件
- 自动匹配并显示对应门店的报表
- 支持关键词搜索和数据筛选

### 3. 财务数据可视化 ⭐新增
- **月度财务趋势图**：自动识别并展示"毛利-线上"和"净利润"的月度变化
- **应收款项提醒**：突出显示"应收-未收额"，帮助门店关注现金流
- **关键指标展示**：显示总额、净利率等重要财务指标
- **自定义分析**：支持选择任意指标进行趋势分析

### 4. 数据导出
- 支持下载完整报表（Excel格式）
- 支持下载筛选后的数据
- 支持导出CSV格式

### 5. 数据分析
- 显示数值列的统计信息
- 支持数据透视表分析
- 相关性分析和热力图

## 快速开始

### 生成测试数据
```bash
# 运行示例数据生成脚本
python generate_sample_data.py
```
这将生成两个示例文件：
- `示例门店权限表.xlsx`
- `示例财务报表.xlsx`

### 启动系统
```bash
streamlit run app.py
```

### 测试流程
1. 上传生成的示例文件
2. 使用任意门店和对应编号登录（如：北京店/011）
3. 查看财务报表和趋势图

## 安装说明

### 1. 环境要求
- Python 3.8 或更高版本
- pip 包管理器

### 2. 安装步骤

```bash
# 克隆或下载项目文件
git clone [项目地址]
cd [项目目录]

# 安装依赖
pip install -r requirements.txt

# 运行系统
streamlit run app.py
```

## 使用指南

### 1. 准备数据文件

#### 权限表格式
创建一个Excel文件，包含以下两列：
- 第1列：门店名称
- 第2列：人员编号

示例：
| 门店名称 | 人员编号 |
|---------|---------|
| 北京店   | 001     |
| 北京店   | 002     |
| 上海店   | 101     |
| 上海店   | 102     |

#### 报表文件格式
- Excel文件，包含多个Sheet
- 每个Sheet名称应包含对应的门店名称
- 例如："北京店_2024财务报表"、"上海店_月度报表"等

**推荐的报表数据格式**（用于自动识别财务指标）：
| 项目名称 | 1月 | 2月 | 3月 | ... | 合计 |
|---------|-----|-----|-----|-----|------|
| 三. 毛利-线上 | 40000 | 48000 | 44000 | ... | 290000 |
| 五. 净利润 | 25000 | 33000 | 29000 | ... | 200000 |
| 应收-未收额 | 5000 | 3000 | 7000 | ... | 33000 |

### 2. 系统操作流程

1. **启动系统**
   ```bash
   streamlit run app.py
   ```

2. **上传文件**
   - 在左侧边栏上传门店权限表
   - 上传包含各门店报表的Excel文件

3. **用户登录**
   - 选择所属门店
   - 输入人员编号
   - 点击登录

4. **查看报表**
   - 登录成功后自动显示对应门店的报表
   - 使用搜索框筛选数据
   - 选择显示行数

5. **下载数据**
   - 点击相应按钮下载报表
   - 可选择Excel或CSV格式

### 3. 管理员功能

系统提供管理员模式，可以：
- 查看完整的权限表
- 查看所有可用的报表Sheet

启用方式：
1. 勾选侧边栏的"管理员模式"
2. 输入管理员密码（默认：admin123，请修改）

## 配置说明

### 修改管理员密码
在 `app.py` 文件中找到以下代码并修改：
```python
if admin_password == "admin123":  # 请修改为实际密码
```

### 自定义样式
可以在文件开头的CSS部分修改界面样式：
```python
st.markdown("""
    <style>
    .main-header {
        font-size: 2.5rem;
        color: #1f77b4;
        ...
    }
    </style>
""", unsafe_allow_html=True)
```

## 注意事项

1. **数据安全**
   - 请确保权限表的准确性
   - 定期更新人员权限信息
   - 建议在内网环境使用

2. **文件格式**
   - 权限表支持 Excel (.xlsx, .xls) 和 CSV 格式
   - 报表文件仅支持 Excel 格式
   - Sheet名称需要包含门店名称

3. **性能优化**
   - 对于大型报表，建议分页显示
   - 避免一次上传过大的文件

## 故障排除

### 常见问题

1. **无法找到对应门店的报表**
   - 检查Sheet名称是否包含门店名称
   - 确认门店名称拼写一致
   - 查看"所有可用的报表"确认Sheet名称

2. **登录失败**
   - 确认门店名称和人员编号正确
   - 检查权限表格式是否正确
   - 确保没有多余的空格

3. **文件上传失败**
   - 检查文件格式是否支持
   - 确认文件没有损坏
   - 尝试重新保存文件

## 更新日志

### v2.1 (最新版本)
- ⭐ 新增月度财务趋势分析功能
- ⭐ 自动识别"毛利-线上"和"净利润"数据并生成对比图
- ⭐ 突出显示"应收-未收额"提醒功能
- ⭐ 添加关键财务指标展示（总额、净利率等）
- 优化数据分析界面，使用标签页组织功能
- 添加示例数据生成脚本
- 改进错误处理和用户提示

### v2.0
- 优化用户界面
- 增加数据搜索和筛选功能
- 支持多种下载格式
- 添加数据分析功能
- 改进错误处理
- 增加管理员模式

### v1.0
- 基础登录功能
- 报表查看和下载

## 技术支持

如有问题，请联系IT部门。
